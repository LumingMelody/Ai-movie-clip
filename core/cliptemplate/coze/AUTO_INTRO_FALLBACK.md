# 自动产品介绍降级方案

## 功能说明

在 `auto_live_reply.py` 中已实现自动产品介绍降级方案，当直播间长时间没有收到弹幕时，系统会自动触发**AI生成的产品介绍**功能，确保直播间始终有高质量的内容输出。

## 核心实现

### 1. 降级触发条件
- 当连续 **90秒** 没有收到任何弹幕消息时触发
- 自动介绍间隔为 **120秒**，避免过于频繁
- 播放介绍时会更新最后消息时间，防止重复触发

### 2. AI智能生成介绍
系统使用Qwen大模型实时生成个性化的产品介绍，每次都会产生不同的内容。AI会根据不同的提示词风格生成介绍：

- **专业主播风格**：生成自然流畅的产品介绍，包含产品特点、价格优惠等信息
- **经验带货风格**：重点突出产品的实用性和性价比
- **轻松活泼风格**：用活泼的语气介绍产品功能和优惠
- **热情推荐风格**：真诚可信地突出产品的独特卖点
- **专业接地气风格**：既专业又贴近用户，展现产品价值

**AI生成的优势**：
- 每次介绍都是独特的，避免重复
- 内容更加丰富和自然
- 可以根据产品特点灵活调整介绍重点
- 语言表达更加生动，提高用户兴趣

### 3. 工作流程
1. **监控弹幕活动**：系统持续监控最后一条弹幕的接收时间
2. **触发条件检查**：每5秒检查一次是否满足触发条件
3. **AI生成内容**：调用Qwen大模型根据产品信息生成个性化介绍
4. **语音合成播放**：生成语音并自动播放（显示预计播放时长）
5. **播放完成提示**：播放完成后显示"✅ 自动产品介绍播放完成"
6. **自动重连机制**：连接断开时自动重试，最多重试5次
7. **保持连接稳定**：使用ping/pong机制保持WebSocket连接活跃

### 4. 可配置参数

```python
# 在创建WebSocketClient时可配置
client = WebSocketClient(
    host='10.211.55.3', 
    port=8888,
    reply_probability=0.3,      # 随机回复概率
    max_queue_size=5           # 最大消息队列长度
)

# 降级策略参数（可在创建后调整）
client.no_message_timeout = 90       # 无消息超时时间（默认90秒）
client.auto_introduce_interval = 120 # 自动介绍间隔（默认120秒）
```

## 使用方法

1. **启动程序**
```bash
python auto_live_reply.py
```

2. **查看日志**
- 当自动介绍功能启动时：`🤖 自动介绍功能已启动 - 无弹幕超时: 90秒, 介绍间隔: 120秒`
- 当触发自动介绍时：`⏰ 90秒内没有收到弹幕，触发自动产品介绍`
- AI生成中：`🤖 正在使用AI生成产品介绍...`
- 播放介绍时：`🎯 自动产品介绍 (预计时长: X秒): [介绍内容]`
- 播放完成：`✅ 自动产品介绍播放完成`
- 连接状态：`📢 提示：如果90秒内没有弹幕，将自动触发AI产品介绍`
- 保活设置：`📡 WebSocket保活设置 - Ping间隔: 30秒, Ping超时: 20秒`

3. **产品配置**
确保 `live_config/product_config.json` 中包含完整的产品信息：
```json
{
    "product_name": "产品名称",
    "price": 99,
    "discount": "限时8折",
    "features": ["功能1", "功能2", "功能3"]
}
```

## 特点
- **AI智能生成**：使用Qwen大模型实时生成个性化产品介绍，每次都不重复
- **智能降级**：只在无人互动时自动介绍，有弹幕时优先回复弹幕
- **多样化风格**：5种不同的AI提示词风格，确保内容丰富多样
- **自动重连**：WebSocket连接断开时自动重连，保证服务稳定性
- **可配置性**：超时时间和间隔时间都可以根据需要调整
- **无缝集成**：与现有的弹幕回复功能完美配合

## 注意事项
- 确保已配置正确的DashScope API Key
- 产品配置文件需要包含完整信息（产品名称、价格、特点、优惠）
- AI生成的内容长度适中，一般在30-45秒的播放时长
- 系统会自动计算并显示预计播放时长
- WebSocket连接使用ping/pong机制保持活跃（每30秒发送ping）
- 自动产品介绍只在本地播放，不会发送到WebSocket服务器
- 连接断开时会自动重连，确保服务稳定性
- **音频文件管理**：临时音频文件播放完成后会自动删除，节省存储空间
- **存储优化**：系统关闭时会清理可能残留的临时音频文件